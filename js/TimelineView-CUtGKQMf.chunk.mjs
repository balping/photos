import{_ as u,d as f,i as y,a as m,s as l,u as A,v as F}from"./vue.runtime.esm-wF2fFWue.chunk.mjs";import{m as a}from"./index-BbxzoNy3.chunk.mjs";import{a as _}from"./video-CrhXjoWi.chunk.mjs";import{P as C,u as w,s as g}from"./filters-CQrIymM5.chunk.mjs";import{N as k}from"./NcActionButton-DC3oAI2L-BhpXyok_.chunk.mjs";import{y as v,q as d,A as r,b as N,B as S,N as x,E as n,R as c}from"./index-CTNdzbN6.chunk.mjs";import{N as B}from"./NcEmptyContent-CYKsI4Rs.chunk.mjs";import{n as i,I as M,P as h,A as I,F as O,e as P,k as L,r as $,D as T}from"./icons-CuFSQtXO.chunk.mjs";import{a as D}from"./NcAvatar-BEIBwiA6-DJPJHN7I.chunk.mjs";import{A as U}from"./ActionFavorite-BOzv2ulG.chunk.mjs";import{A as p}from"./AlbumForm-C5cU-FYT.chunk.mjs";import{N as Y}from"./NcListItem-CifyXFmv-IoClyLXb.chunk.mjs";import{N as E}from"./NcUserBubble-C7XtYsrf-B7CYT7lQ.chunk.mjs";import{F as V}from"./FetchCollectionsMixin-DAcViopU.chunk.mjs";import{F as j}from"./FileComponent-Bcu1buEq.chunk.mjs";import{F as H,a as q}from"./FilesSelectionMixin-CheUEr2k.chunk.mjs";import{H as Q}from"./HeaderNavigation-BrU1Mszy.chunk.mjs";import{F as R}from"./FetchFilesMixin-D7IiP-we.chunk.mjs";import{F as z}from"./FilesByMonthMixin-BXldxaIn.chunk.mjs";import"./preload-helper-DxYC2qmj.chunk.mjs";import"./index-WU3CHJK8.chunk.mjs";import"./dialog-Dl5SDzoT.chunk.mjs";import"./index-CjT9PcQN.chunk.mjs";import"./PhotosFiltersInput-8n2HBaym.chunk.mjs";import"./NcSelect-okD5YTJq-PWKB7YqJ.chunk.mjs";import"./useModelMigration-EhAWvqDD-e4u0t71x.chunk.mjs";import"./NcDateTimePicker-3gwTkp-C.chunk.mjs";import"./useFormatDateTime-GuOsxPvN.chunk.mjs";import"./NcDialog-C1b3UtA7-CYO5DJER.chunk.mjs";import"./NcDateTime-kanSdMgW-CQ-QHYib.chunk.mjs";import"./collectionFetcher-MldZRZIF.chunk.mjs";import"./NcTextField-eKuP0G6I-B6Jbs4al.chunk.mjs";import"./index-x9vhq81Z.chunk.mjs";import"./NcSelectUsers-DK3EtvnG-dJWVkvwG.chunk.mjs";import"./FetchCollectionContentMixin-t55QgLh4.chunk.mjs";import"./AbortControllerMixin-BPZZCq9U.chunk.mjs";import"./NcVNodes-DFuuFSV_.chunk.mjs";import"./NcCheckboxRadioSwitch-DqdNvkCt-BkTfUUkA.chunk.mjs";import"./fileFetcher-zlpTUABY.chunk.mjs";import"./PhotoSearch-BmlUkHN1.chunk.mjs";const J={name:"ActionDownload",components:{NcActionLink:D},props:{title:{type:String,required:!0},selectedFileIds:{type:Array,required:!0}},computed:{files(){return this.$store.state.files.files},downloadUrl(){const t=new URLSearchParams;return t.append("files",JSON.stringify(this.paths)),u(`/apps/files/ajax/download.php?${t}`)},paths(){return this.selectedFileIds.map(t=>this.files[t].path)}}};var G=function(){var t=this,e=t._self._c;return e("NcActionLink",{attrs:{"close-after-click":!0,href:t.downloadUrl,download:t.downloadUrl,"aria-label":t.title}},[t._v(" "+t._s(t.title)+" "),t._t("icon",null,{slot:"icon"})],2)},K=[],W=i(J,G,K,!1,null,null);const X=W.exports,Z=f({name:"AlbumPicker",components:{Plus:h,ImageMultipleOutline:M,NcButton:d,NcListItem:Y,NcLoadingIcon:v,NcUserBubble:E,AlbumForm:p},filters:{toCoverUrl(t){return u(`/apps/photos/api/v1/preview/${t}?x=64&y=64`)}},mixins:[V],data(){return{showAlbumCreationForm:!1}},computed:{albums(){return this.$store.getters.albums},sharedAlbums(){return this.$store.getters.sharedAlbums},allAlbums(){return[...Object.values(this.albums),...Object.values(this.sharedAlbums)]}},mounted(){this.fetchAlbumList()},methods:{async fetchAlbumList(){await this.fetchCollections(`/photos/${l()?.uid}/albums`,r),await this.fetchCollections(`/photos/${l()?.uid}/sharedalbums`,r)},albumCreatedHandler(){this.showAlbumCreationForm=!1,this.fetchAlbumList()},pickAlbum(t){this.$emit("album-picked",t)},isSharedAlbum(t){return t.path.match(/^\/photos\/.+\/sharedalbums\//)!==null},originalName(t){return this.isSharedAlbum(t)?t.basename.replace(new RegExp(`\\(${t.attributes.collaborators[0].id}\\)$`),""):t.basename},t:m,n:y}});var tt=function(){var t=this,e=t._self._c;return t._self._setupProxy,t.showAlbumCreationForm?e("AlbumForm",{attrs:{"display-back-button":!0,title:t.t("photos","New album")},on:{back:function(o){t.showAlbumCreationForm=!1},done:t.albumCreatedHandler}}):e("div",{staticClass:"album-picker"},[e("h2",[t._v(" "+t._s(t.t("photos","Add to Album"))+" "),t.loadingCollections?e("NcLoadingIcon",{staticClass:"loading-icon"}):t._e()],1),e("ul",{staticClass:"albums-container"},t._l(t.allAlbums,function(o){return e("NcListItem",{key:o.attributes.filename,staticClass:"album",attrs:{name:t.originalName(o),"aria-label":t.t("photos","Add selection to album {albumName}",{albumName:o.basename})},on:{click:function(s){return t.pickAlbum(o)}},scopedSlots:t._u([{key:"subname",fn:function(){return[t._v(" "+t._s(t.n("photos","%n item","%n photos and videos",o.attributes.nbItems))+" "),t.isSharedAlbum(o)?[t._v(" ⸱ "+t._s(t.t("photos","Shared by"))+" "),e("NcUserBubble",{attrs:{"display-name":o.attributes.collaborators[0].label,user:o.attributes.collaborators[0].id}})]:t._e()]},proxy:!0}],null,!0)},[e("template",{slot:"icon"},[o.attributes["last-photo"]!==-1?e("img",{staticClass:"album__image",attrs:{src:t._f("toCoverUrl")(o.attributes["last-photo"])}}):e("div",{staticClass:"album__image album__image--placeholder"},[e("ImageMultipleOutline",{attrs:{size:32}})],1)])],2)}),1),e("NcButton",{staticClass:"new-album-button",attrs:{"aria-label":t.t("photos","Create a new album."),variant:"tertiary"},on:{click:function(o){t.showAlbumCreationForm=!0}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("Plus")]},proxy:!0}],null,!1,1489515321)},[t._v(" "+t._s(t.t("photos","Create new album"))+" ")])],1)},et=[],ot=i(Z,tt,et,!1,null,"9619a86f");const st=ot.exports,it={name:"TimelineView",components:{DeleteOutline:T,PlusBoxMultipleOutline:$,DownloadOutline:L,Close:P,Plus:h,FolderAlertOutline:O,NcEmptyContent:B,NcModal:x,NcActions:S,NcActionButton:k,NcButton:d,AlbumForm:p,AlbumPicker:st,FilesListViewer:q,FileComponent:j,ActionFavorite:U,ActionDownload:X,HeaderNavigation:Q,PhotosSourceLocationsSettings:C,AlertCircleOutline:I},filters:{dateMonth(t){return a(t,"YYYYMM").format("MMMM")},dateYear(t){return a(t,"YYYYMM").format("YYYY")}},mixins:[R,H,z],beforeRouteLeave(t,e,o){window.scrollTo(0,0),o(),Object.keys(this.selectedFilters).forEach(s=>{this.selectedFilters[s]=[]})},props:{onlyFavorites:{type:Boolean,default:!1},mimesType:{type:Array,default:()=>N},onThisDay:{type:Boolean,default:!1},rootTitle:{type:String,required:!0}},setup(){const t=_(),e=w(),{selectedFilters:o,filtersQuery:s}=g(e);return{isMobile:t,selectedFilters:o,filtersQuery:s}},data(){return{loadingCount:0,showAlbumCreationForm:!1,showAlbumPicker:!1,appContent:document.getElementById("app-content-vue"),showFilters:!1}},computed:{files(){return this.$store.state.files.files},createAlbumButtonLabel(){return Object.keys(this.selectedFilters).length>0?this.t("photos","Create new album from filters"):this.t("photos","Create new album")}},watch:{filtersQuery(){this.resetFetchFilesState(),this.getContent()}},mounted(){F(c,this.handleUserConfigChange)},destroyed(){A(c,this.handleUserConfigChange)},methods:{getContent(){this.fetchFiles({mimesType:this.mimesType,onThisDay:this.onThisDay,onlyFavorites:this.onlyFavorites,extraFilters:this.filtersQuery})},openViewer(t){window.OCA.Viewer.open({fileInfo:n(this.files[t]),list:Object.values(this.fileIdsByMonth).flat().map(e=>n(this.files[e]))})},openUploader(){},async addSelectionToAlbum(t){this.showAlbumPicker=!1,await this.$store.dispatch("addFilesToCollection",{collectionFileName:t.root+t.path,fileIdsToAdd:this.selectedFileIds})},async deleteSelection(){const t=this.selectedFileIds;this.onUncheckFiles(t),this.fetchedFileIds=this.fetchedFileIds.filter(e=>!t.includes(e)),await this.$store.dispatch("deleteFiles",t)},handleUserConfigChange({key:t}){t==="photosSourceFolders"&&this.resetFetchFilesState()},handleFormCreationDone({album:t}){this.showAlbumCreationForm=!1,this.$router.push(`/albums/${t.basename}`)},t:m}};var lt=function(){var t=this,e=t._self._c;return t.errorFetchingFiles?e("div",{staticClass:"timeline__empty-content"},[t.errorFetchingFiles===404?e("NcEmptyContent",{attrs:{name:t.t("photos","One of the source folders does not exist")}},[e("FolderAlertOutline",{attrs:{slot:"icon"},slot:"icon"}),e("PhotosSourceLocationsSettings",{staticClass:"timeline__update_source_directory",attrs:{slot:"action"},slot:"action"})],1):e("NcEmptyContent",{attrs:{name:t.t("photos","An error occurred")}},[e("AlertCircleOutline",{attrs:{slot:"icon"},slot:"icon"})],1)],1):e("div",{staticClass:"timeline"},[e("HeaderNavigation",{key:"navigation",attrs:{loading:t.loadingCount>0,path:"/",title:t.rootTitle,"root-title":t.rootTitle},on:{refresh:t.resetFetchFilesState}},[e("div",{staticClass:"timeline__header__left"},[t.selectedFileIds.length===0?e("NcButton",{ref:"newAlbumButton",attrs:{"aria-label":t.createAlbumButtonLabel,"data-cy-header-action":"create-album"},on:{click:function(o){t.showAlbumCreationForm=!0}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("PlusBoxMultipleOutline")]},proxy:!0}],null,!1,2448450972)},[t._v(" "+t._s(t.createAlbumButtonLabel)+" ")]):[e("NcButton",{attrs:{"close-after-click":!0,variant:"primary","aria-label":t.t("photos","Add to album"),"data-cy-header-action":"add-to-album"},on:{click:function(o){t.showAlbumPicker=!0}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("Plus")]},proxy:!0},t.isMobile?null:{key:"default",fn:function(){return[t._v(" "+t._s(t.t("photos","Add to album"))+" ")]},proxy:!0}],null,!0)}),t.selectedFileIds.length>0?e("NcButton",{attrs:{"aria-label":t.t("photos","Unselect all"),"data-cy-header-action":"unselect-all"},on:{click:t.resetSelection},scopedSlots:t._u([{key:"icon",fn:function(){return[e("Close")]},proxy:!0},t.isMobile?null:{key:"default",fn:function(){return[t._v(" "+t._s(t.t("photos","Unselect all"))+" ")]},proxy:!0}],null,!0)}):t._e(),e("NcActions",{attrs:{"aria-label":t.t("photos","Open actions menu")}},[e("ActionDownload",{attrs:{"selected-file-ids":t.selectedFileIds,title:t.t("photos","Download selected files"),"data-cy-header-action":"download-selection"}},[e("DownloadOutline",{attrs:{slot:"icon"},slot:"icon"})],1),e("ActionFavorite",{attrs:{"selected-file-ids":t.selectedFileIds}}),e("NcActionButton",{attrs:{"close-after-click":!0,"aria-label":t.t("photos","Delete selection"),"data-cy-header-action":"delete-selection"},on:{click:t.deleteSelection},scopedSlots:t._u([{key:"icon",fn:function(){return[e("DeleteOutline")]},proxy:!0}])},[t._v(" "+t._s(t.t("photos","Delete selection"))+" ")])],1)]],2)]),e("FilesListViewer",{ref:"filesListViewer",staticClass:"timeline__file-list",attrs:{"container-element":t.appContent,"file-ids-by-section":t.fileIdsByMonth,sections:t.monthsList,loading:t.loadingFiles,"base-height":t.isMobile?120:200,"empty-message":t.t("photos","No photos or videos in here")},on:{"need-content":t.getContent},scopedSlots:t._u([{key:"default",fn:function({file:o,isHeader:s,distance:b}){return[s?e("h2",{staticClass:"section-header",attrs:{id:`file-picker-section-header-${o.id}`}},[e("b",[t._v(t._s(t._f("dateMonth")(o.id)))]),t._v(" "+t._s(t._f("dateYear")(o.id))+" ")]):e("FileComponent",{attrs:{file:t.files[o.id],"allow-selection":!0,selected:t.selection[o.id]===!0,distance:b},on:{click:t.openViewer,"select-toggled":t.onFileSelectToggle}})]}}])}),t.showAlbumCreationForm?e("NcModal",{key:"albumCreationForm",attrs:{"label-id":"new-album-form","set-return-focus":t.$refs.newAlbumButton?.$el},on:{close:function(o){t.showAlbumCreationForm=!1}}},[e("h2",{staticClass:"timeline__heading"},[t._v(" "+t._s(t.t("photos","New album"))+" ")]),e("AlbumForm",{attrs:{"filters-value":t.selectedFilters},on:{done:t.handleFormCreationDone}})],1):t._e(),t.showAlbumPicker?e("NcModal",{key:"albumPicker",attrs:{"label-id":"album-picker"},on:{close:function(o){t.showAlbumPicker=!1}}},[e("AlbumPicker",{on:{"album-picked":t.addSelectionToAlbum}})],1):t._e()],1)},at=[],rt=i(it,lt,at,!1,null,"055b120f");const Jt=rt.exports;export{Jt as default};
//# sourceMappingURL=TimelineView-CUtGKQMf.chunk.mjs.map
